#! /usr/bin/env coffee

# Required modules

FS = require('fs')
YaMoney = require('..')

# Read token from file pointed in CLI args

tokenPath = process.argv[2]
token = JSON.parse(FS.readFileSync(tokenPath, encoding: 'utf-8')).access_token

# Parse payment system params provided in CLI

payload = Object.create(null)

for item in process.argv[3...]
	[key, value] = item.split('=')
	payload[key] = value

# Create client and invoke necessary methods

client = new YaMoney.Client(token)

client.requestPayment(payload, (error, data) ->
	unless error?
		console.log(data)

		client.processPayment((error, data) ->
			unless error? console.log(data) else console.log(error)

			undefined
		)
	else
		console.log(error)

	undefined
)
