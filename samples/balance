#! /usr/bin/env coffee

# Required modules

FS = require('fs')
YaMoney = require('..')

# Check provided CLI args

unless process.argv.length is 3
	programName = process.argv[1].match(/[^/]+$/)[0]
	console.log('Usage: ' + programName + ' TOKEN_PATH')
	process.exit()

# Read token from file pointed in CLI args

tokenPath = process.argv[2]
token = JSON.parse(FS.readFileSync(tokenPath, encoding: 'utf-8')).access_token

# Create client and set access token

client = new YaMoney.Client(host: 'money.yandex.ru', port: 443, charset: 'utf-8')
client.setToken(token)

# And invoke necessary methods

client.accountInfo((error, info) ->
	unless error? then console.log(info) else console.log(error)

	undefined
)
